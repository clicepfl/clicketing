'use client';

import { Editor } from '@monaco-editor/react';
import { Event } from '@prisma/client';
import { useRef, useState } from 'react';

const emptyTemplate = '<!DOCTYPE html>\n<html>\n<body>\n\n</body>\n</html>';
const placeholderQrCode =
  'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAA0GVYSWZJSSoACAAAAAoAAAEEAAEAAAAgAAAAAQEEAAEAAAAgAAAAAgEDAAMAAACGAAAAEgEDAAEAAAABAAAAGgEFAAEAAACMAAAAGwEFAAEAAACUAAAAKAEDAAEAAAACAAAAMQECAA0AAACcAAAAMgECABQAAACqAAAAaYcEAAEAAAC+AAAAAAAAAAgACAAIAEgAAAABAAAASAAAAAEAAABHSU1QIDIuMTAuMzgAADIwMjQ6MDY6MzAgMjM6NTA6NDAAAQABoAMAAQAAAAEAAAAAAAAA6K3GOQAAASNpQ0NQSUNDIHByb2ZpbGUAAHicnZC9SsRAFIW/rLKKaOVPoSIpbLcRTGXhqhAEhRhXcLXKJllcTGJIsiy+gW+iD7OFIPgM1grWnokWFqZx4HI+LveeMzPQspMwLWf3Ic2qwvW7/cv+lT33RpstVtlhIwjLvOt5JzSez1csoy8d49U89+dpR3EZSqeqLMyLCqw9sTOpcsMqVm57/qH4QWxHaRaJn8TbURoZNrt+mozDH09zm8U4uzg3fdUmLsec4mEzYMyIhIqONFPnCIddqUtBwD0loTQhVm+imYobUSknlwNRT6TbNOSt13meUgbyGMnLJNyRytPkYf73e+3jrN601qZ5UAR1a0bVGg7h/RGW+rD8DAvXDVnzv9/WMOPUM/984xdcalCer6cbuwAADXhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+Cjx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDQuNC4wLUV4aXYyIj4KIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgIHhtbG5zOkdJTVA9Imh0dHA6Ly93d3cuZ2ltcC5vcmcveG1wLyIKICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICB4bXBNTTpEb2N1bWVudElEPSJnaW1wOmRvY2lkOmdpbXA6OTJhOWNkMzEtMDNjZC00NTIwLTgyNDUtZjY1MjUwMjg5ZTk2IgogICB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmQzZTI2NWM2LWJkMWItNDA1OC05ZmYzLTczYmMxYjRlY2UyNyIKICAgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjRlYmVhZTQ2LWE1YzEtNDkwNy05ZTVhLTI4OGRiMGViYzBlMSIKICAgZGM6Rm9ybWF0PSJpbWFnZS9wbmciCiAgIEdJTVA6QVBJPSIyLjAiCiAgIEdJTVA6UGxhdGZvcm09IkxpbnV4IgogICBHSU1QOlRpbWVTdGFtcD0iMTcxOTc4NDI0MDk1OTM4MyIKICAgR0lNUDpWZXJzaW9uPSIyLjEwLjM4IgogICB0aWZmOk9yaWVudGF0aW9uPSIxIgogICB4bXA6Q3JlYXRvclRvb2w9IkdJTVAgMi4xMCIKICAgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNDowNjozMFQyMzo1MDo0MCswMjowMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQ6MDY6MzBUMjM6NTA6NDArMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiYzA5OTllYi0zZGZmLTQxOTAtOGRjMy03YzhhZmI2YTI0MzkiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDI0LTA2LTMwVDIzOjUwOjQwKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PlZQ4QwAAAACYktHRAAh5uQzbAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+gGHhUyKMtte1MAAAMESURBVEjHpdVNaFxVFAfw35sklWD8KIGKdSFUHArix0QQKRQqVkk61NIEDAEXLtxY7ULFpSu7lm4mkk2QgrZd2IobF1XRbV1os2rTXaQKWjtNLWgzM++4mNubN/kQwXs3795z7v/de87/f04RthoF0+5xWgtvmXMnztl6xIaJpkWjlnW1lHrmdS0btagZm/0HjtZMGtYS2kohdHWFULohtAybVNseYFzPqtXK5gEvVFZ/uqVnvAownN9c1/CTmvvT2674wYwZhb987jl1jIHx4qAfY3kgBphNlw7hgicDJrS1TQQ85UK2l2YrT0DNTvUM0HUiw+6yK39/kOIRSnU7+7Hom6b0simEa4otsrOszB6hZ2odYMQtIdzM/s9vOj6RFzeEsGokhFpB00k1hKN+Bh1zmwgzpwN+8SoYcrJo9k2LCfl3nNARwh+GNzDkVyF0fIjrybDY5/GotsuOaztobz718gDAgbx4wkFtx13RNhqYtqz0qSFLzuOSUuj4ZABgwZpQuoTzlgz5TGnZNHMpOatWHMK7KSO3jebjIym8Xe/gkJXE1m4/Vh8L4bQdAQ/nlM5kgFdykh8J2OGsEOYDrXTgSHb/RlfoOJd3zlgTur7OO0cTF1q1aglI45QahjWLBym41xEjqDm1hTfmhXAso9/n73Th1wNeS+y744Hs87YQWmE9iB9VYn52/cr4SkfoOFPxOLkexOnE8asV8+HM94eMZwkdHtBF3E1jn0ghPF1JWzsBvOmNFOR2n/sBjaSJ0Rig8heVP8xbE3q+dUFXWNOqWL8cpHJTKxHjxeyyL9eGTvral20vJeW2NNfl3Ae47jG77TemsDKg52sKY/bb7VG/VeW8saD0lMJC1uWatazBBaGseE5tVdK69njfRZIuy8SBvbjoPXv0hNLjd0tajRCltgZCzaSGhmdctiQUCmHJZQ0Nz5pUCExEO8rBqlw3q1559VXfpev2fO9qxVI3q759Y7mZ6uNW87bVjY1lu9Z2o9Il/mtr27a5tv6tuRb/t73/A3cOoHyfh1Z6AAAAAElFTkSuQmCC';

export default function MailEditor({ event }: { event: Event }) {
  const editorRef = useRef(null);
  const [template, setTemplate] = useState(event.mailTemplate || emptyTemplate);

  return (
    <div>
      <Editor
        height="40vh"
        language="html"
        onMount={(editor, monaco) => (editorRef.current = editor)}
        onChange={setTemplate}
        value={template}
      />
      <button onClick={() => alert(editorRef.current.getValue())}>Test</button>
      <div
        dangerouslySetInnerHTML={{
          __html: template.replace(
            /src\s*=\s*(['"])qrcode\1/,
            `src="data:image/png;base64,${placeholderQrCode}"`
          ),
        }}
      />
    </div>
  );
}
